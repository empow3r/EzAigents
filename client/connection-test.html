<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Connection Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #0a0a0a; color: #e0e0e0; }
        .status { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background: rgba(76, 175, 80, 0.2); border: 1px solid #4caf50; }
        .error { background: rgba(244, 67, 54, 0.2); border: 1px solid #f44336; }
        .info { background: rgba(33, 150, 243, 0.2); border: 1px solid #2196f3; }
    </style>
</head>
<body>
    <h1>🔧 Observability Connection Test</h1>
    
    <div id="results"></div>
    
    <script>
        const results = document.getElementById('results');
        
        function addStatus(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `status ${type}`;
            div.textContent = message;
            results.appendChild(div);
            console.log(message);
        }
        
        // Test 1: Basic connectivity
        addStatus('🌐 Testing basic HTTP connectivity...');
        
        fetch('/events?limit=1')
            .then(response => response.json())
            .then(data => {
                addStatus('✅ HTTP API connection successful', 'success');
                addStatus(`📊 Events endpoint returned ${Array.isArray(data) ? data.length : 'data'}`, 'info');
                
                // Test 2: WebSocket connectivity
                addStatus('🔌 Testing WebSocket connection...');
                
                const wsUrl = `ws://${window.location.hostname}:${window.location.port || '3001'}/ws`;
                addStatus(`🔗 Attempting connection to: ${wsUrl}`, 'info');
                
                const ws = new WebSocket(wsUrl);
                
                ws.onopen = () => {
                    addStatus('✅ WebSocket connection successful!', 'success');
                    addStatus('🎉 All systems operational - you can now use the dashboard', 'success');
                    
                    // Send a test message
                    ws.send(JSON.stringify({ type: 'ping' }));
                };
                
                ws.onmessage = (event) => {
                    addStatus(`📨 WebSocket message received: ${event.data}`, 'info');
                };
                
                ws.onerror = (error) => {
                    addStatus('❌ WebSocket connection failed', 'error');
                    console.error('WebSocket error:', error);
                };
                
                ws.onclose = () => {
                    addStatus('🔌 WebSocket connection closed', 'info');
                };
                
                // Close after test
                setTimeout(() => {
                    if (ws.readyState === WebSocket.OPEN) {
                        ws.close();
                    }
                }, 5000);
                
            })
            .catch(error => {
                addStatus('❌ HTTP API connection failed', 'error');
                addStatus(`Error: ${error.message}`, 'error');
                console.error('HTTP error:', error);
            });
        
        // Test 3: Browser capabilities
        addStatus('🔍 Testing browser capabilities...');
        
        if (typeof WebSocket !== 'undefined') {
            addStatus('✅ WebSocket support detected', 'success');
        } else {
            addStatus('❌ WebSocket not supported in this browser', 'error');
        }
        
        if (typeof fetch !== 'undefined') {
            addStatus('✅ Fetch API support detected', 'success');
        } else {
            addStatus('❌ Fetch API not supported in this browser', 'error');
        }
        
        // Test 4: URLs
        addStatus(`🌍 Current URL: ${window.location.href}`, 'info');
        addStatus(`🏠 Base URL: ${window.location.origin}`, 'info');
        addStatus(`🔌 WebSocket URL: ws://${window.location.hostname}:${window.location.port || '3001'}/ws`, 'info');
    </script>
</body>
</html>